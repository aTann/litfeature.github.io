
性能优化不能只着眼于局部的代码

__一切没有 profiling 的性能都是耍流氓__

凡是真正有价值的性能优化，必定是从端到端的业务场景建立体系来考虑的

性能体系的建立可以分成以下几个部分：
- 现状评估和建立指标
- 技术方案
- 执行
- 结果评估和监控


### 现状评估和建立指标

正确地评估现状和建立指标是最关键的一步

指标：
- 一方面，对用户来说，什么样的性能指标能更好地评估它的体验？
- 另一方面，对公司来说，什么样的指标会影响业务价值呢？

性能问题分为几个方面：
- 页面加载性能 __跟用户的流失率有非常强的关联性，而用户流失率，正是公司业务非常看重的指标__
- 动画与操作性能
- 内存、电量消耗

__“用户平均加载时间”__ 存在的问题：
- 当加载时间低于一定数字，用户体感差别不大了，经过作者团队的研究，认为这个数字大约是 1 秒
- 少数超长时间加载的用户（如 2G ），会极大影响整个指标，即指标不能反映大多数用户的体验

新的指标 ———— **秒开率**，即一秒之内打开的用户占用户总量的百分比。


### 技术方案

要想做好性能优化，绝对不能把自己限制在局部的视角，必须是整个业务一起考虑，才能有良好的收效


技术方案划分
- 缓存
  - 客户端控制的强缓存策略
- 降低请求成本
  - HTTP DNS：由客户端控制，隔一段时间主动请求 DNS 获取域名 IP，不走系统的 DNS
  - TCP/TLS 连接复用：由服务端升级到 HTTP2（当时我们做的时候还是 SPDY），尽量合并域名
- 减少请求数
  - Javascript、CSS 打包到 HTML
  - 用 Javascript 控制图片异步加载和懒加载
  - 小型图片使用 data-uri
- 减少传输体积
  - 尽量使用 SVG\gradient 等代替图片
  - 根据机型和网络状况控制图片清晰度
  - 对低清晰图片使用锐化来提升体验
  - 设计上避免大型背景图















