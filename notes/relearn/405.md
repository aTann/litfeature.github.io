# 前端架构：前端架构有哪些核心问题？

在工程领域，我们凡是要做点什么事儿，都会有明确的目的性，这个目的性，一定是为了完成生产服务业务的。

前端是个天然按照页面解耦的技术，在多页面架构中，页面的复杂度大约刚好适合一个人的工作量。

前端架构需要考虑的问题：
1. 多人协同时的质量和效率 -- 组件化
2. 前端特有的兼容性问题


对于一些追求极致的团队来说，会挑战“单页面应用”，通过单页面应用来提升用户体验，单页面应用的升级版本是谷歌提出的 PWA，PWA 既是业务方案也是技术方案，在技术层面，它近乎苛刻地规定了网页的各方面的体验标准。


前端领域还有一个特有的生态：框架
- 第一代前端框架（如 `jQuery`, `PrototypeJS`）重点解决了兼容问题和 API 的易用性问题，在现代浏览器普及之后，这些问题逐渐变得不存在或者不重要
- 第二代前端框架（如 `Vue`，`Angular`，`React`）重点解决了组件化问题

选择合适的框架，可以节约架构的成本，还能够享受社区资源


## 组件化

有五种主流选择：
- `Web Component` 是 W3C 推行的规范，理论上是未来的选项
  - 实际上这份标准的状态堪忧，`Shadow DOM` 的设计比较复杂，一般的前端掌握起来都比较困难
  - `CSS` 也比较难以应用，需要依靠 `CSS Houdini`
  - 优势也非常明显：不需要任何额外的运行时支持，就能在现代浏览器环境运行，也可以跟 HTML 无缝结合
- `Vue` 目前最受欢迎的框架（从 github star 来看），由华人程序员尤小右开发和维护。
  - 一个主要特定是比较符合原本的 JavaScript/CSS/HTML 书写习惯；
  - 另一个主要特点是它绑定了 MVVM 模式，直接确定了 UI 架构，通过 DSL 的支持，数据交互非常简洁
- `React` 是 Facebook 推行的新一代 Web 框架。它利用 JSX 模式，把 HTML、CSS 和 JavaScript 都放进了 js 文件中
  - 对于不喜欢 CSS 和 HTML 的前端工程师来说，是很理想的
  - 还可以迁移到 React Native，直接编写简单的客户端应用
- `Angular` 是 Google 推出的 Web 框架，它是比较标准的 MVVM 模式
  - 曾经因为大版本兼容性而饱受诟病
  - 目前它的核心竞争力是与 TypeScript 结合得较好（2019 年的）
- 自研


做技术选型时的主要依据是团队的现状，开发移动端还是桌面端、是否跟 Native 结合、团队成员的技能分布都是需要考虑的因素，这些框架本身的特点，目前我认为仅仅是一种偏好选项，而不是关键因素。

## 兼容性和适配性

前端开发的特有问题就是兼容性，到了移动时代，需要面对不同的机型，我们又需要解决适配性问题。

兼容性问题到 2011 年左右都是前端的主旋律，但是在之后，随着现代浏览器的逐渐普及，兼容性问题逐渐减小，不必过多考虑浏览器兼容性问题

适配问题主要适配的是屏幕的三个要素：
- 单位英寸像素数（Pixel Per Inch，PPI）：现实世界的一英寸内像素数，决定了屏幕的显示质量，主要影响的是文字，可以采用 `media` 规则来适配
- 设备像素比率（Device Pixel Ratio，DPR）：物理像素与逻辑像素（px）的对应关系，需要用到 CSS 的 `viewport` 规则来控制缩放比例解决
- 分辨率（Resolution）：屏幕区域的宽高所占像素数，可以使用 `vw` 单位解决

## 单页应用

浏览器加载 HTML 时是会有白屏过程的，对追求极致体验的团队来说，希望能够进一步提升体验，于是就有了“单页应用（SPA）”的概念

单页应用是把多个页面的内容实现在同一个实际页面内的技术，因为失去了页面的天然解耦，所以就要解决耦合问题。也就是说，我们要在一个“物理页面”内，通过架构设计来实现若干个“逻辑页面”。

逻辑页面应该做到独立开发和独立发布，一种思路是，每个逻辑页面一个 js，用一个 SPA 框架加载 js 文件。

有一个隐性需求：保持前进后退历史

一般来说，前进后退历史使用 URL 的 Hash 部分来控制，但是 onhashchange 事件并没有提供前进或者后退信息，目前还没有完美的解决方案，只能牺牲一部分体验

实现单页应用的逻辑页面发布需要改造发布系统，在工程上，这也是一个比较大的挑战


## 扩展前端新边界

前端架构的职责还包括扩展前端的边界

前端架构还包含了很多 Native 开发任务：
- 客户端和前端结合的方案 Weex 和 React Native；
- 前端和图形学结合的方案 GCanvas；
- 前端的 3D 框架 Three.js

这些都是试图用架构的手段赋予前端新的能力的尝试
