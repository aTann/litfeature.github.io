
# 持续集成：几十个前端一起工作，如何保证工作质量？

持续集成是近现代软件工程中的一个非常重要的概念。它是指在软件开发过程中，以定期或者实时的方式，集成所有人的工作成果，做统一的构建和测试。

持续集成的优势是 __及早处理集成阶段的问题，使软件质量和开发进度可控__ 。

持续集成还有升级版本：持续交付和持续部署

与持续集成相对的做法是：独立开发各个模块，在软件开发的最终阶段才做集成。

## 持续集成总论
传统软件的持续集成主要措施：
- `daily build`:，每日构建，开发者每天提交代码到代码仓库，构建一个可运行的版本
- `build verification test (BVT)`，构建验证测试，每日构建版本出来后，运行一组自动化的测试用例，保证基本功能可用

前端一些现实方面对区别：
- 前端代码按页面自然解耦，大部分页面都是单人开发
- 前端构建逻辑简单，一般开发阶段都保证构建成功，不需要构建
- 前端代码一般用于开发界面，测试自动化成本极高
- 前端页面跳转，是基于 URL，没有明确的产品边界

## 持续集成的目标

持续集成的根本目标：
- 要及早集成代码形成可测试的版本
- 通过一定的测试来验证提交的代码的有效性

## 持续集成的方案

前端的持续集成的措施：
- 预览环境，代替每日构建，前端每次（或指定次）提交代码到仓库都同步到预览环境，保证预览环境总是可用
- 规则校验，代替构建验证测试，通过数据采集（如性能数据）和代码扫描，保证提交的代码满足一定的质量要求

### 预览环境

1. 申请机器和域名，需要运维协助，在预览环境的机器上部署 Web 应用服务器
2. 建立预览环境发布机制
   - 脚本发布
   - git hook
   - 使用一个 Web 应用平台，进行白屏操作

预览环境的部署和发布机制建立是最基本的需求

### 规则校验

规则校验分成 3 种措施：
- __页面结构扫描__，可使用无头浏览器（如 `phantomjs`）配合一些 Javascript 代码编写的规则来完成
- __运行时数据采集__，可通过页面插入公共 js 文件的方式来完成，最基本的是用 `Performance API` 来采集性能数据，用 `window.onerror` 来采集 js 错误
- __代码扫描__，社区有一些现成方案，如 `JSHint`，根据实际需要选择社区方案或自研

## 持续集成的实施

持续集成的实施，是必须严格做到自动化和制度化的

我们刚刚讲解的规则校验仅仅是搭建好了平台，而规则本身，我们需要先形成一个共识，然后在前端团队内部形成一定的更新机制。

建议用 `issue` 的方式来管理规则的提案，可以在周会或者月会上讨论，充分保证整个团队对校验规则的一致意见

警惕三种错误：
- 少数人拍脑袋决定校验规则
- 一成不变的校验规则
- 频繁无规律变化的校验规则

校验规则决定了整个前端团队的开发体验，所以必须非常慎重。

### 持续集成的结果

持续集成机制的建立本身就可以视为一种结果，它能够让整个团队的代码质量有一个基本的保障，提前发现问题，统一代码风格，从而带来开发体验和效率的提升。

此外，持续集成的结果也能够以数据的方式呈现出整个开发团队的健康状态，这是管理者会非常关注的一个点。


扩展：
1. [实战：阿里巴巴 DevOps 转型后的运维平台建设](https://segmentfault.com/a/1190000014088336)