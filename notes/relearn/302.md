实际上，对浏览器的实现者来说，他们做的事情，就是把一个 `URL` 变成一个屏幕上显示的网页。

一个浏览器到底是如何工作的：
1. 浏览器首先使用 `HTTP` 协议或者 `HTTPS` 协议，向服务端请求页面；
2. 把请求回来的 `HTML` 代码经过解析，构建成 `DOM` 树
3. 计算 `DOM` 树上的 `CSS` 属性；
4. 最后根据 `CSS` 属性对元素逐个进行渲染，得到内存中的位图
5. 一个可选的步骤是对位图进行合成，这会极大地增加后续绘制的速度
6. 合成之后，再绘制到界面上

扩展：
1. [浏览器的工作原理：新式网络浏览器幕后揭秘](https://www.html5rocks.com/zh/tutorials/internals/howbrowserswork)
2. [图说 Firefox 全新 CSS 引擎](https://segmentfault.com/a/1190000014520262)

```
字符流 -》 状态机 -》 词 token -》 栈 -》 DOM 树
```

“词”（指编译原理的术语 `token`，表示最小的有意义的单元）

`token` 种类大约只有标签开始、属性、标签结束、注释、`CDATA` 节点几种

1. 词（token）是如何被拆分的

```html
<p class="a">text text text</p>
```

- `<p` “标签开始” 的开始
- `class="a"` 属性
- `>` “标签开始” 的结束
- `text text text` 文本
- `</p>` 标签结束


| 示例词 | 解释 |
|:--:|:--:|
| `<abc` | “开始标签”的开始 |
| `a="xxx"` | 属性 |
| `/>` | “开始标签”的结束 |
| `</xxx>` | 结束标签 |
| `hello world` | 文本节点 |
| `<!---xxx--->` | 注释 |
| `<![CDATA[hello world!]]>` | CDATA 数据节点 |


每读入一个字符，其实都要做一次决策，而且这些决定是跟“当前状态”有关的。在这样的条件下，浏览器工程师要想实现把字符流解析成词（token），最常见的方案就是使用状态机



2. 状态机
![状态机](https://static001.geekbang.org/resource/image/8b/b0/8b43d598bc1f83a8a1e7e8f922013ab0.png)


构建 DOM 树

把这些简单的词变成 DOM 树，这个过程我们是使用栈来实现的，任何语言几乎都有栈

```html
<html maaa=a >
    <head>
        <title>cool</title>
    </head>
    <body>
        <img src="a" />
    </body>
</html>
```
构建 `DOM` 树：
- 栈顶元素就是当前节点；
- 遇到属性，就添加到当前节点；
- 遇到文本节点，如果当前节点是文本节点，则跟文本节点合并，否则入栈成为当前节点的子节点；
- 遇到注释节点，作为当前节点的子节点；
- 遇到 `tag start` 就入栈一个节点，当前节点就是这个节点的父节点；
- 遇到 `tag end` 就出栈一个节点（还可以检查是否匹配）。

